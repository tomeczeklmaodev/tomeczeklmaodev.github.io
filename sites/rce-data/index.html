---
permalink: /sites/rce-data/
---
<!DOCTYPE html>
<html lang="pl">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>rce-data</title>
	<style>
		body { font-family: monospace; }
		table { border-collapse: collapse; width: 33%; }
		tr { border: 1px #000000 solid; }
		th, td { border: 1px grey dashed; padding: 4px 15px; text-align: center; }
		th { background-color: grey; color: #ffffff; }
		tr:nth-child(odd) { background-color: #f5f5f5; }
		.negative-price { color: red; }

		@media (max-width: 700px) {
			table {
				width: 100%;
			}
		}
	</style>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body onload="apiGetPriceData()">
	<div id="header"></div>
	<table>
		<!-- dlaczego na tym musi być ID to ja nie wiem -->
		<tbody id="data"></tbody>
	</table>
	<script src="https://cdn.jsdelivr.net/gh/tomeczeklmaooo/tomeczeklmaooo.github.io@master/scripts/logging.js"></script>
	<script>
		var baseURL = 'https://api.raporty.pse.pl/api/rce-pln?$filter=doba%20ge%20'; // %20 = spacja, %27 = '
		function apiGetPriceData()
		{
			// dzisiejsza data
			var date = new Date();
			var year = date.getFullYear();
			var month = date.getMonth() + 1;
			var day = date.getDate();
			// doklejanie '0' z przodu jeżeli dzień lub miesiąc są mniejsze od 10
			if (month < 10) month = '0' + month;
			if (day < 10) day = '0' + day;

			var fulldate = '%27' + year + '-' + month + '-' + day + '%27';
			llog(`fulldate: ${fulldate}`);
			var fetchURL = baseURL + fulldate + '&$first=192';
			llog(`fetchURL: ${fetchURL}`);
			
			fetch(fetchURL).then((res) => res.text()).then((text) => {
				text = JSON.parse(text);
				// var text_readable = JSON.stringify(text, undefined, 4);
				// document.body.appendChild(document.createElement('pre')).innerHTML = text_readable;
				var loopLimiter = 0;

				document.getElementById("header").innerHTML += `Dane pobrane: ${text["value"][0]["doba"]}<br><br>`;
				document.getElementById("data").innerHTML += "<tr><th>Godzina</th> <th>Dzisiaj</th> <th>Jutro</th></tr>";

				llog(`Received JSON objects equal to ${text["value"].length}`);

				// jeżeli w zwróconym JSON będzie więcej niż 96 elementów to 3 kolumny
				if (text["value"].length > 96)
				{
					for (var i = 0; i < text["value"].length; i++)
					{
						if (text["value"][i]["udtczas"].substring(14) == '45') // wypisywanie danych o cenie tylko raz z każdej godziny bo ta sama jest co 15 minut
						{
							if (text["value"][i]["rce_pln"].toFixed(2) < 0 && text["value"][i + 96]["rce_pln"].toFixed(2) < 0)
							{
								document.getElementById("data").innerHTML +=
									`<tr>
										<td>${text["value"][i]["udtczas"].substring(11).replace("45", "00")}</td>
										<td class="negative-price">${text["value"][i]["rce_pln"].toFixed(2)}</td>
										<td class="negative-price">${text["value"][i + 96]["rce_pln"].toFixed(2)}</td>
									</tr>`;
							}
							else if (text["value"][i]["rce_pln"].toFixed(2) < 0)
							{
								document.getElementById("data").innerHTML +=
									`<tr>
										<td>${text["value"][i]["udtczas"].substring(11).replace("45", "00")}</td>
										<td class="negative-price">${text["value"][i]["rce_pln"].toFixed(2)}</td>
										<td>${text["value"][i + 96]["rce_pln"].toFixed(2)}</td>
									</tr>`;
							}
							else if (text["value"][i + 96]["rce_pln"].toFixed(2) < 0)
							{
								document.getElementById("data").innerHTML +=
									`<tr>
										<td>${text["value"][i]["udtczas"].substring(11).replace("45", "00")}</td>
										<td>${text["value"][i]["rce_pln"].toFixed(2)}</td>
										<td class="negative-price">${text["value"][i + 96]["rce_pln"].toFixed(2)}</td>
									</tr>`;
							}
							else
							{
								document.getElementById("data").innerHTML +=
									`<tr>
										<td>${text["value"][i]["udtczas"].substring(11).replace("45", "00")}</td>
										<td>${text["value"][i]["rce_pln"].toFixed(2)}</td>
										<td>${text["value"][i + 96]["rce_pln"].toFixed(2)}</td>
									</tr>`;
							}
							// limitowanie ilości pętli, bo jak w linku jest 'ge' to wtedy wyświetla się też północ dnia następnego
							loopLimiter += 1;
							if (loopLimiter == 24) { lsuccess(`Price data for today and tomorrow fetched successfully.`); break; }
						}
					}
				}
				else // to jeżeli nie będzie ceny jeszcze (2 kolumny)
				{
					lwarning(`Cena na jutro nie została jeszcze opublikowana!`);

					for (var i = 0; i < text["value"].length; i++)
					{
						if (text["value"][i]["udtczas"].substring(14) == '45') // wypisywanie danych o cenie tylko raz z każdej godziny bo ta sama jest co 15 minut
						{
							if (text["value"][i]["rce_pln"].toFixed(2) < 0)
							{
								document.getElementById("data").innerHTML +=
									`<tr>
										<td>${text["value"][i]["udtczas"].substring(11).replace("45", "00")}</td>
										<td class="negative-price">${text["value"][i]["rce_pln"].toFixed(2)}</td>
										<td>---</td>
									</tr>`;
							}
							else
							{
								document.getElementById("data").innerHTML +=
									`<tr>
										<td>${text["value"][i]["udtczas"].substring(11).replace("45", "00")}</td>
										<td>${text["value"][i]["rce_pln"].toFixed(2)}</td>
										<td>---</td>
									</tr>`;
							}
							// limitowanie ilości pętli, bo jak w linku jest 'ge' to wtedy wyświetla się też północ dnia następnego
							loopLimiter += 1;
							if (loopLimiter == 24) { lsuccess(`Price data for today fetched successfully.`); break; }
						}
					}
				}
			}).catch((e) => console.error(e));
		}
	</script>
</body>
</html>