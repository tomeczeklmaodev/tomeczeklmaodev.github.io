---
permalink: /sites/rce-data/daily/
---
<!--
	rce-data: głównie służy do odświeżania danych o rynkowej cenie energii elektrycznej
-->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>rce-data/daily</title>
	<style>
		body
		{
			font-family: monospace;
		}
		div#data
		{
			white-space: pre;
			/*font-size: 2.5vh;*/
		}
		.link
		{
			text-decoration: none;
			border: 1px black dashed;
			border-radius: 5px;
			padding: 0 5px;
			font-size: 14pt;
			background-color: white;
			user-select: none;
			-moz-user-select: none;
			-webkit-user-select: none;
		}
		.link:hover
		{
			cursor: pointer;
		}
		div.bottom
		{
			position: fixed;
			bottom: 10px;
		}
	</style>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body onload="apiGetPriceData(0)">
	<div id="data"></div>
	<script>
		var baseURL = 'https://api.raporty.pse.pl/api/rce-pln?$filter=doba ge '; // %20 = spacja, %27 = '
		function apiGetPriceData(days_ahead)
		{
			var date = new Date();
			var year = date.getFullYear();
			var month = date.getMonth() + 1;
			var day = date.getDate();
			if (days_ahead == 0) // ceny na dzisiaj
			{
				if (month < 10) month = '0' + month;
				if (day < 10) day = '0' + day;
				var fulldate =  '\'' + year + '-' + month + '-' + day  + '\'';
				console.log(`fulldate: ${fulldate}`);
				var urlProxy = 'https://corsproxy.io/?' + encodeURIComponent(baseURL + fulldate);
				console.log(`urlProxy: ${urlProxy}`);
				fetch(urlProxy).then((res) => res.text()).then((text) => {
					text = JSON.parse(text);
					// var text_readable = JSON.stringify(text, undefined, 4);
					// document.body.appendChild(document.createElement('pre')).innerHTML = text_readable;
					
					document.getElementById("data").innerHTML = "";
					document.getElementById("data").innerHTML += text["value"][0]["doba"] + "\n\n";
					for (var i = 0; i < text["value"].length; i++)
					{
						if (text["value"][i]["udtczas"].substring(14) == '45') // wypisywanie danych o cenie tylko raz z każdej godziny bo ta sama jest co 15 minut
						{
							if (text["value"][i]["rce_pln"].toFixed(2) < 0)
							{
								document.getElementById("data").innerHTML += "<span style=\"color: red;\">" + text["value"][i]["udtczas"].substring(11).replace("45", "00") + " - " + text["value"][i]["rce_pln"].toFixed(2) +"</span>\n";
							}
							else
							{
								document.getElementById("data").innerHTML += text["value"][i]["udtczas"].substring(11).replace("45", "00") + " - " + text["value"][i]["rce_pln"].toFixed(2) +"\n";
							}
						}
					}

					console.log(`json_len: ${text["value"].length}`);
					// jeżeli w zwróconym JSON będzie więcej niż 96 elementów to wtedy pokaże przycisk
					if (text["value"].length > 96)
					{
						document.getElementById("data").innerHTML += "<div class=\"bottom\"><a class=\"link\" onclick=\"apiGetPriceData(1)\">JUTRO &gt;</a></div>";
					}
				}).catch((e) => console.error(e));
			}
			else if (days_ahead == 1) // ceny na jutro
			{
				// sprawdzenie czy dzisiaj jest ostatni dzień, jeżeli tak to dodajemy 1 do miesiąca i resetujemy dzień na 0 (bo potem i tak dodajemy 1 do tego)
				var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
				if (day == lastDay.getDate())
				{
					day = 0;
					month += 1;
				}
				
				day += 1; // days_ahead = 1
				if (month < 10) month = '0' + month;
				if (day < 10) day = '0' + day;
				var fulldate = '\'' + year + '-' + month + '-' + day + '\'';
				console.log(`[days_ahead: ${days_ahead}] fulldate: ${fulldate}`);
				var urlProxy = 'https://corsproxy.io/?' + encodeURIComponent(baseURL + fulldate);
				console.log(`[days_ahead: ${days_ahead}] urlProxy: ${urlProxy}`);
				fetch(urlProxy).then((res) => res.text()).then((text) => {
					text = JSON.parse(text);

					document.getElementById("data").innerHTML = "";
					document.getElementById("data").innerHTML += text["value"][0]["doba"] + "\n\n";
					for (var i = 0; i < text["value"].length; i++)
					{
						if (text["value"][i]["udtczas"].substring(14) == '45') // wypisywanie danych o cenie tylko raz z każdej godziny bo ta sama jest co 15 minut
						{
							if (text["value"][i]["rce_pln"].toFixed(2) < 0)
							{
								document.getElementById("data").innerHTML += "<span style=\"color: red;\">" + text["value"][i]["udtczas"].substring(11).replace("45", "00") + " - " + text["value"][i]["rce_pln"].toFixed(2) +"</span>\n";
							}
							else
							{
								document.getElementById("data").innerHTML += text["value"][i]["udtczas"].substring(11).replace("45", "00") + " - " + text["value"][i]["rce_pln"].toFixed(2) +"\n";
							}
						}
					}
					document.getElementById("data").innerHTML += "<div class=\"bottom\"><a class=\"link\" onclick=\"apiGetPriceData(0)\">&lt; DZISIAJ</a></div>";
				}).catch((e) => console.error(e));
			}
		}
	</script>
</body>
</html>